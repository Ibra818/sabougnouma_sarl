<section id="galerie" class="gallery section">
  <div class="container">
    <!-- Section Header -->
    <div class="section-header text-center">
      <div class="section-badge glass">
        <svg class="badge-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M9,12L11,14L15,10L20,15V19A2,2 0 0,1 18,21H4A2,2 0 0,1 2,19V15L9,12M18,3A2,2 0 0,1 20,5V13.17L15,8.17L11,12.17L9,10.17L2,17.17V5A2,2 0 0,1 4,3H18M15.5,6A1.5,1.5 0 0,0 14,7.5A1.5,1.5 0 0,0 15.5,9A1.5,1.5 0 0,0 17,7.5A1.5,1.5 0 0,0 15.5,6Z"/>
        </svg>
        <span>Notre Galerie</span>
      </div>
      <h2 class="section-title">
        <span class="gradient-text">Nos Réalisations</span>
      </h2>
      <p class="section-subtitle">
        Découvrez nos projets et services à travers notre galerie d'images
      </p>
    </div>

    <!-- Gallery Filter -->
    <div class="gallery-filters">
      <button 
        class="filter-btn" 
        [class.active]="activeFilter === 'all'"
        (click)="filterGallery('all')">
        Tout
      </button>
      <button 
        class="filter-btn" 
        [class.active]="activeFilter === 'nettoyage'"
        (click)="filterGallery('nettoyage')">
        Nettoyage
      </button>
      <button 
        class="filter-btn" 
        [class.active]="activeFilter === 'decoration'"
        (click)="filterGallery('decoration')">
        Décoration
      </button>
      <button 
        class="filter-btn" 
        [class.active]="activeFilter === 'restauration'"
        (click)="filterGallery('restauration')">
        Restauration
      </button>
      <button 
        class="filter-btn" 
        [class.active]="activeFilter === 'agrobusiness'"
        (click)="filterGallery('agrobusiness')">
        Agrobusiness
      </button>
    </div>

    <!-- Gallery Info -->
    <div class="gallery-info text-center">
      <p class="gallery-counter">
        Affichage de {{ displayedGallery.length }} sur {{ filteredGallery.length }} images
        <span class="gallery-layout-info">(2 lignes de 3 images)</span>
      </p>
    </div>

    <!-- Gallery Grid -->
    <div class="gallery-masonry" [class.loading]="isLoading">
      <div 
        *ngFor="let item of displayedGallery; let i = index"
        class="gallery-item"
        [class.hidden]="!item.visible"
        [style.animation-delay]="(i * 0.1) + 's'"
        (click)="openLightbox(item, i)">
        
        <div class="gallery-image image-modern">
          <img 
            [src]="item.src" 
            [alt]="item.alt" 
            loading="lazy"
            (load)="onImageLoad(i)">
          
          <div class="gallery-overlay">
            <div class="overlay-content">
              <h4>{{ item.title }}</h4>
              <p>{{ item.description }}</p>
              <div class="gallery-meta">
                <span class="category">{{ item.category }}</span>
                <svg class="zoom-icon" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M15.5,14L20.5,19L19,20.5L14,15.5V14.71L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14Z"/>
                </svg>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Load More Button -->
    <div class="gallery-actions text-center" *ngIf="hasMoreImages">
      <button class="btn-modern btn-lg" (click)="loadMore()" [disabled]="isLoading">
        <span *ngIf="!isLoading">
          Voir plus d'images ({{ filteredGallery.length - displayedGallery.length }} restantes)
        </span>
        <span *ngIf="isLoading">Chargement...</span>
        <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor" *ngIf="!isLoading">
          <path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"/>
        </svg>
        <div class="loading-spinner" *ngIf="isLoading">
          <svg class="spinner" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="32" stroke-dashoffset="32">
              <animate attributeName="stroke-dasharray" dur="2s" values="0 32;16 16;0 32;0 32" repeatCount="indefinite"/>
              <animate attributeName="stroke-dashoffset" dur="2s" values="0;-16;-32;-32" repeatCount="indefinite"/>
            </circle>
          </svg>
        </div>
      </button>
    </div>
  </div>

  <!-- Lightbox Modal -->
  <div class="lightbox-overlay" [class.active]="lightboxActive" (click)="closeLightbox()">
    <div class="lightbox-content" (click)="$event.stopPropagation()">
      <button class="lightbox-close" (click)="closeLightbox()">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
        </svg>
      </button>
      
      <div class="lightbox-image" *ngIf="currentImage">
        <img [src]="currentImage.src" [alt]="currentImage.alt">
      </div>
      
      <div class="lightbox-info" *ngIf="currentImage">
        <h3>{{ currentImage.title }}</h3>
        <p>{{ currentImage.description }}</p>
        <span class="lightbox-category">{{ currentImage.category }}</span>
      </div>
      
      <div class="lightbox-nav">
        <button class="nav-btn prev" (click)="previousImage()" [disabled]="currentImageIndex === 0">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"/>
          </svg>
        </button>
        <button class="nav-btn next" (click)="nextImage()" [disabled]="currentImageIndex === filteredGallery.length - 1">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
</section>